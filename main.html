<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RotMG DPS Optimizer made by Ammmar</title>
<style>
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background-color: #0f0f10;
    color: #f2f2f2;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  header {
    text-align: center;
    margin-top: 40px;
  }

  h1 {
    color: #00b8ff;
    font-size: 1.8em;
    margin-bottom: 8px;
  }

  p {
    color: #a6a6a6;
    font-size: 0.95em;
    margin: 0 0 30px;
  }

  .container {
    width: 95%;
    max-width: 700px;
    background: #1b1b1f;
    border-radius: 10px;
    padding: 25px 20px;
    box-shadow: 0 0 15px rgba(0, 184, 255, 0.2);
  }

  .form-group {
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
  }

  label {
    font-size: 14px;
    color: #bdbdbd;
    margin-bottom: 6px;
  }

  input {
    padding: 10px;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    background: #2a2a30;
    color: #fff;
  }

  .radio-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  fieldset {
    border: 1px solid #333;
    border-radius: 8px;
    padding: 15px;
    margin-top: 10px;
  }

  legend {
    color: #bdbdbd;
    font-size: 13px;
  }

  .shot-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 10px;
  }

  .shot-item {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }

  .shot-item input {
    flex: 1 1 120px;
  }

  .btn {
    width: 100%;
    padding: 12px;
    background: #00b8ff;
    color: #fff;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
    font-size: 15px;
  }

  .btn:hover {
    background: #0096d1;
  }

  .secondary {
    background: #7b5cff;
  }

  .result {
    margin-top: 25px;
    background: #121214;
    padding: 15px;
    border-radius: 8px;
    font-size: 16px;
  }

  .error {
    color: #ff7a7a;
  }
</style>
</head>
<body>
  <header>
    <h1>Realm of the Mad God DPS Optimizer made by Ammmar</h1>
    <p>Automatically finds the best Attack/Dexterity split for most Damage Per Second on a build.</p>
  </header>

  <div class="container">
    <div class="form-group">
      <label for="defense">Target Defense</label>
      <input type="number" id="defense" placeholder="e.g. 60">
    </div>

    <div class="form-group">
      <label for="totalPoints">Total Expected Combined Points (ATT + DEX)</label>
      <input type="number" id="totalPoints" placeholder="e.g. 150">
    </div>

    <div class="form-group">
      <label for="numShots">Number of Shots</label>
      <input type="number" id="numShots" value="1" min="1">
    </div>

    <fieldset>
      <legend>Shot Configuration</legend>
      <div class="radio-group">
        <label><input type="radio" name="mode" value="same" checked> Same for all shots</label>
        <label><input type="radio" name="mode" value="different"> Different per shot</label>
      </div>

      <div id="sameInputs" class="form-group" style="margin-top: 10px;">
        <label>Weapon's Average Damage per Shot</label>
        <input type="number" id="sameDamage" placeholder="e.g. 100">
        <label>Rate of Fire (1.0 = 100%)</label>
        <input type="number" id="sameRoF" value="1.0" step="0.01">
      </div>

      <div id="diffInputs" class="shot-list" style="display:none;"></div>

      <p style="color:#999; font-size:13px; margin-top:8px;">
        Tip: If your weapon has a damage range, use the average (min + max) ÷ 2 for each shot.
      </p>
    </fieldset>

    <button class="btn" id="calcBtn">Calculate Optimal DPS</button>
    <button class="btn secondary" id="topBtn">Show Top 5 Splits</button>

    <div id="result" class="result"></div>
  </div>

<script>
function perShotDamage(base, ATT, DEF) {
  const raw = base * (0.5 + ATT / 50);
  return Math.max(raw - DEF, raw * 0.15);
}

function shotsPerSecond(rof, DEX) {
  return rof * (1.5 + 6.5 * (DEX / 75));
}

function totalDPS(shots, ATT, DEX, DEF) {
  return shots.reduce((sum, s) => {
    const dmg = perShotDamage(s.damage, ATT, DEF);
    const sps = shotsPerSecond(s.rof, DEX);
    return sum + dmg * sps;
  }, 0);
}

function buildShotInputs() {
  const container = document.getElementById("diffInputs");
  container.innerHTML = "";
  const n = parseInt(document.getElementById("numShots").value) || 1;
  for (let i = 1; i <= n; i++) {
    const div = document.createElement("div");
    div.className = "shot-item";
    div.innerHTML = `
      <input type="number" step="0.1" class="shot-dmg" placeholder="Shot ${i} Avg Damage">
      <input type="number" step="0.01" class="shot-rof" value="1.0" placeholder="Shot ${i} RoF">
    `;
    container.appendChild(div);
  }
}

function getInputs() {
  const DEF = parseFloat(document.getElementById("defense").value);
  const total = parseInt(document.getElementById("totalPoints").value);
  const num = parseInt(document.getElementById("numShots").value);
  const mode = document.querySelector('input[name="mode"]:checked').value;

  if (isNaN(DEF) || isNaN(total) || isNaN(num)) throw new Error("Please fill all required fields.");

  const shots = [];
  if (mode === "same") {
    const dmg = parseFloat(document.getElementById("sameDamage").value);
    const rof = parseFloat(document.getElementById("sameRoF").value);
    if (isNaN(dmg) || isNaN(rof)) throw new Error("Please enter average damage and rate of fire.");
    for (let i = 0; i < num; i++) shots.push({ damage: dmg, rof: rof });
  } else {
    const rows = [...document.querySelectorAll(".shot-item")];
    if (rows.length !== num) throw new Error("Missing shot rows.");
    for (const row of rows) {
      const dmg = parseFloat(row.querySelector(".shot-dmg").value);
      const rof = parseFloat(row.querySelector(".shot-rof").value);
      if (isNaN(dmg) || isNaN(rof)) throw new Error("Each shot must have valid values.");
      shots.push({ damage: dmg, rof: rof });
    }
  }
  return { DEF, total, shots };
}

function findOptimal(shots, DEF, total) {
  let best = { ATT: 0, DEX: 0, DPS: 0 };
  for (let ATT = 0; ATT <= total; ATT++) {
    const DEX = total - ATT;
    const dps = totalDPS(shots, ATT, DEX, DEF);
    if (dps > best.DPS) best = { ATT, DEX, DPS: dps };
  }
  return best;
}

function topSplits(shots, DEF, total, k = 5) {
  const results = [];
  for (let ATT = 0; ATT <= total; ATT++) {
    const DEX = total - ATT;
    results.push({ ATT, DEX, DPS: totalDPS(shots, ATT, DEX, DEF) });
  }
  results.sort((a, b) => b.DPS - a.DPS);
  return results.slice(0, k);
}

document.getElementById("numShots").addEventListener("change", buildShotInputs);
document.querySelectorAll('input[name="mode"]').forEach(r =>
  r.addEventListener("change", e => {
    if (e.target.value === "same") {
      document.getElementById("sameInputs").style.display = "";
      document.getElementById("diffInputs").style.display = "none";
    } else {
      document.getElementById("sameInputs").style.display = "none";
      document.getElementById("diffInputs").style.display = "";
      buildShotInputs();
    }
  })
);

document.getElementById("calcBtn").addEventListener("click", () => {
  const result = document.getElementById("result");
  try {
    const { DEF, total, shots } = getInputs();
    const best = findOptimal(shots, DEF, total);
    result.innerHTML = `
      <b>Optimal Stat Distribution</b><br>
      Attack: ${best.ATT}<br>
      Dexterity: ${best.DEX}<br>
      <b>Max DPS:</b> ${best.DPS.toFixed(2)}
    `;
  } catch (err) {
    result.innerHTML = `<p class="error">${err.message}</p>`;
  }
});

document.getElementById("topBtn").addEventListener("click", () => {
  const result = document.getElementById("result");
  try {
    const { DEF, total, shots } = getInputs();
    const top = topSplits(shots, DEF, total);
    result.innerHTML = `<b>Top 5 ATT/DEX Splits</b><br>` +
      top.map((r, i) => `${i + 1}. ATT ${r.ATT} / DEX ${r.DEX} — DPS ${r.DPS.toFixed(2)}`).join("<br>");
  } catch (err) {
    result.innerHTML = `<p class="error">${err.message}</p>`;
  }
});
</script>
</body>
</html>


